####################################################
# This template configures a demolist for use
# with pt_extlist
#
# @author Michael Knoll <knoll@punkt.de>, Daniel Lienert <lienert@punkt.de>
# @package Typo3
# @subpackage pt_extlist
####################################################



plugin.tx_ptextlist.settings {

    ## Remove these lines for activating CSV rendering
    #controller.List.list.view = Tx_PtExtlist_View_List_CsvListView
    #
    #
    #view.CsvListView {
    #    fileName = test.csv
    #    fileHandlingType = D
    #    useDateAndTimestampInFilename = 1
    #    fileNamePrefix = demolist
    #}
    
    _LOCAL_LANG.default.emptyList = blabla

    listConfig.demolist {
    
    	backendConfig < plugin.tx_ptextlist.prototype.backend.typo3
        backendConfig {
            
            datasource {
                # no configuration required here
            }
            
            
            tables (
                static_countries,
				static_territories st_continent,
				static_territories st_subcontinent
            )
            
            
            baseFromClause (
            	static_countries
				LEFT JOIN static_territories AS	st_subcontinent	ON (static_countries.cn_parent_tr_iso_nr = st_subcontinent.tr_iso_nr)
				LEFT JOIN static_territories AS	st_continent ON (st_subcontinent.tr_parent_iso_nr = st_continent.tr_iso_nr) 
            )
            
            baseWhereClause (
            	st_continent.tr_name_en <> '' 
				AND st_subcontinent.tr_name_en <> ''
            ) 
            
        }
        
        
        fields {
            
	        name_local {
				table = static_countries
				field = cn_short_local
				isSortable = 1
				
			}
	
			name_en {
				field = cn_short_en
				table = static_countries
			}
	
			uno_member {
				field = cn_uno_member
				table = static_countries
			}
	
			capital {
				table = static_countries
				field = cn_capital
			
			}
	
			iso2 {
				table = static_countries
				field = cn_iso_2
				isSortable = 0
			}
	
			phone {
				table = static_countries
				field = cn_phone
			}
	
			isoNo {
				table = static_countries
				field = cn_currency_iso_nr
			}
	
			continent {
				table = st_continent
				field = tr_name_en
			}
	
			subcontinent {
				table = st_subcontinent
				field = tr_name_en
			}
	
			countryuid {
				table = static_countries
				field = uid
			}
	            
        }

		pager {
			pagerConfigs {
				second {
					enabled = 1
			        pagerClassName = Tx_PtExtlist_Domain_Model_Pager_DefaultPager
			        templatePath = EXT:pt_extlist/Resources/Private/Templates/Pager/second.html
			        
			        showNextLink = 1
			        showPreviousLink = 1
			        showFirstLink = 0
			        showLastLink = 0
				}
			}
		}

        
        columns {
	           10 {
				# choose a columnIdentifier
				columnIdentifier = nameColumn
	
				# This label will be displayed in the item list (use lll here)
				label = LLL:EXT:pt_extlist/Configuration/TypoScript/Demolist/locallang.xml:column_nameColumn
	
				# Set the dataDescriptions this columns refers to
				# the dataDescriptionIdentifier is a single reference to a dataDescription if type is default
				# or a csl list of referencs if type is "virtual"
				fieldIdentifier = name_local, name_en, countryuid, uno_member
	
				# a column is sortable if "isSortable" is set to 1 _and_
				# all sortingColumns entries this column refers to are sortable too
				isSortable = 1
	
				# sortingDataDescription is a reference to one dataDescription that will be used for sorting
				# if not set, the first entry in dataDescriptionIdentifier will be used
				sortingDataDescription = name_local
	
				renderObj = COA
				renderObj {
					5 = IMAGE
					5.if {
						value.data = field:uno_member
						equals = 1
					}
					5.file = EXT:pt_list/typoscript/static/demolist/un.gif
					5.stdWrap.typolink.parameter = http://www.un.org
					5.stdWrap.typolink.ATagParams = class="un-link"
	
					10 = TEXT
					10.data = field:name_en
					10.append = TEXT
					10.append {
						data = field:name_local
						if {
							value.data = field:name_local
							equals.data = field:name_en
							negate = 1
						}
					}
					10.append.noTrimWrap = | (|)|
					10.wrap3 = |&nbsp;
	
					20 = TEXT
					20.value = Details
					20.typolink.parameter = 1
					20.typolink.additionalParams.dataWrap = &tx_unseretolleextension_controller_details[countryuid]={field:countryuid}
	 			}
	
			}
	
			11 {
				label = Capital
				columnIdentifier = capital
				fieldIdentifier = capital
			}
	
			20 {
				label = LLL:EXT:pt_extlist/Configuration/TypoScript/Demolist/locallang.xml:column_isoNoColumn
				columnIdentifier = isoNoColumn
				fieldIdentifier = iso2
				isSortable = 1
				renderUserFunctions {
					10 = EXT:pt_extlist/Resources/Private/UserFunctions/class.tx_ptextlist_demolist_renderer.php:tx_ptextlist_demolist_renderer->iso2CodeRenderer
				}
			}
	
	
			40 {
				label = Continent
				columnIdentifier = continent
				fieldIdentifier = continent
			}
	
			30 {
				label = Phone
				columnIdentifier = phoneColumn
				# default columns can only operate on _one_ dataDescription
				fieldIdentifier = phone
			}
	
			50 {
				label = Subcontinent
				columnIdentifier = subcontinent
				fieldIdentifier = subcontinent
				accessGroups = 3
			}
        }
        
        renderer {
        	# User function for generating 'special' cell variables
        	specialCell = EXT:pt_extlist/Resources/Private/UserFunctions/class.tx_ptextlist_demolist_specialcell.php:tx_ptextlist_demolist_specialCell->processCell
        }
        
        aggregateData {
        	# methods: sum, min, max, avg
        	sumPhone {
        		fieldIdentifier = phone
        		method = sum
        	}
        	avgPhone {
        		fieldIdentifier = phone
        		method = avg
        	}
        	maxPhone {
        		fieldIdentifier = phone
        		method = max
        	}
        	minPhone {
        		fieldIdentifier = phone
        		method = min
        	}
        }
        
        aggregateRows {
        	10 {
        		phoneColumn {
        			aggregateDataIdentifier = sumPhone, avgPhone, maxPhone, minPhone
        			renderObj = TEXT
					renderObj.dataWrap (
						 Min.: <b>{field:minPhone}</b><br /> 
						 &empty;: <b>{field:avgPhone}</b><br />
						 Max.: <b>{field:maxPhone}</b><br />
						 &sum;: <b>{field:sumPhone}</b><br />
					)
        		}
        	}
        }
        
        
        filters {
	        filterbox1 {
	        	filterConfigs {
	              10 < plugin.tx_ptextlist.prototype.filter.string 
	              10 {
	                  filterIdentifier = filter1
	                  label = Local name
	                  fieldIdentifier = name_local
	              }
	              
	              15 < plugin.tx_ptextlist.prototype.filter.max
	              15 {
	                  filterIdentifier = filter15
	                  label = Max Phone
	                  fieldIdentifier = phone
	              }

    			  20 < plugin.tx_ptextlist.prototype.filter.checkbox 
	              20 {
	                  filterIdentifier = filter2
	                  label = Continent
	                  fieldIdentifier = continent
	                  filterField = continent
	                  displayFields = continent
	                  showRowCount = 1
	                  submitOnChange = 0
					  invert = 0
					  invertable = 0				  
					  
					  excludeFilters = filterbox1.filter3
	              }
	              
	             
	              30 < plugin.tx_ptextlist.prototype.filter.select 
	              30 {
	                  filterIdentifier = filter3
	                  label = Subcontinent
	                  fieldIdentifier = subcontinent
	                  filterField = subcontinent
	                  displayFields = continent, subcontinent
	                  multiple = 0
	                  showRowCount = 1
	                  #excludeFilters = filterbox1.filter1
	                  submitOnChange = 0
					  inactiveOption = [ALL]
					  invert = 0
					  invertable = 0
					  accessGroups = 3
					  }
	              }
	         }
	         
	         filterbox2 {
	         	filterConfigs {
		         	10 < plugin.tx_ptextlist.prototype.filter.firstLetter
		         	10 {
		         		filterIdentifier = filter4
		         		label = Capital
		         		fieldIdentifier = capital
		         		inactiveOption = [ALL]
		         	}
		         }
	         }
        }  
    }
}

# Localization Override
################################
plugin.tx_ptextlist._LOCAL_LANG{
	default {
		emptyList = List is empty.
	}
	de {
		emptyList = Liste ist leer.
	}
}
