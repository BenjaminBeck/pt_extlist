<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>1. API</title><link rel="stylesheet" type="text/css" href="../css/style.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="index.html" title=""><link rel="up" href="ch05.html" title="Chapter 5. xxx"><link rel="prev" href="ch05.html" title="Chapter 5. xxx"><link rel="next" href="ch05s02.html" title="2. Cookbook"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch05.html"><img src="../images/generic-images/png/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch05s02.html"><img src="../images/generic-images/png/next.png" alt="Next"></a></td></tr></table><hr></div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">
    <span class="inlinemediaobject"><img src="images/logo_punktde.png" width="70"></span>
  </a></span> &gt; <span class="breadcrumb-link"><a href="ch05.html">xxx</a></span> &gt; <span class="breadcrumb-node">API</span></div><div class="section" title="1. API"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id287825972"></a>1. API</h2></div></div></div><p>In this section you will learn how to use pt_extlist's API to extend the extension or use it within third-party extensions.</p><div class="section" title="1.1. Extending pt_extlist"><div class="titlepage"><div><div><h3 class="title"><a name="id287825984"></a>1.1. Extending pt_extlist</h3></div></div></div><p>Pt_extlist can be extended in multiple ways. Many of its classes are configured via TypoScript so you can easily exchange them with your own classes to fit your needs. Common types of extensions are changing Data-Backends or writing your own filter classes. We will start with the latter one.</p><div class="section" title="1.1.1. Writing your own filter classes"><div class="titlepage"><div><div><h4 class="title"><a name="id287825992"></a>1.1.1. Writing your own filter classes</h4></div></div></div><p>Recapitulating what has been told about filters in the Architecture chapter, we reintroduce the following class diagram to understand what filters are actually doing:</p><div class="figure"><a name="id287826002"></a><div class="figure-contents"><div class="mediaobject" align="center"><img src="../images/api_filters_01.png" align="middle" width="350" alt="Filter Interface"></div></div><p class="title"><b>Figure 5.1. Filter Interface</b></p></div><p><br class="figure-break"></p><p>By taking a look at the Interface for filters, you see that there are mainly three main purposes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Configuration and State-related stuff</p></li><li class="listitem"><p>Returning a filter query that determines what the filter is actually filtering on the data</p></li><li class="listitem"><p>Creating a filter breadcrumb information</p></li></ol></div><p>Keeping in mind that there are some helpers - namely abstract classes - that do a lot of work for us we do not have to implement much logic when creating a new filter class:</p><div class="figure"><a name="id287826052"></a><div class="figure-contents"><div class="mediaobject" align="center"><img src="../images/api_filters_02.png" align="middle" width="350" alt="Abstract Filter Classes"></div></div><p class="title"><b>Figure 5.2. Abstract Filter Classes</b></p></div><p><br class="figure-break"></p><p>So as you can see  - all that's left for you to implement in your concrete filter class is a method that creates the actual filter criteria.</p><div class="section" title="1.1.1.1. String Filter Example"><div class="titlepage"><div><div><h5 class="title"><a name="id287826074"></a>1.1.1.1. String Filter Example</h5></div></div></div><p>One of the most simple filters shipping with pt_extlist is the String filter. It can filter a string value based on a user input which is also a string. You can find the String-Filter class in the Classes/Domain/Model/Filter/StringFilter.php file.</p><p>Here is the PHP source code:</p><pre class="programlisting">
class Tx_PtExtlist_Domain_Model_Filter_StringFilter extends Tx_PtExtlist_Domain_Model_Filter_AbstractSingleValueFilter {

	/**
	 * Creates filter query from filter value and settings
	 *
	 * @return Tx_PtExtlist_Domain_QueryObject_Criteria Criteria for current filter value (null, if empty)
	 */
	protected function buildFilterCriteria(Tx_PtExtlist_Domain_Configuration_Data_Fields_FieldConfig $fieldIdentifier) {

		if ($this-&gt;filterValue == '') {
			return NULL;
		}

		$fieldName = Tx_PtExtlist_Utility_DbUtils::getSelectPartByFieldConfig($fieldIdentifier);
		$filterValue = '%'.$this-&gt;filterValue.'%';

		$criteria = Tx_PtExtlist_Domain_QueryObject_Criteria::like($fieldName, $filterValue);

		return $criteria;
	}
}</pre><p>The most important function is <span class="italic">buildFilterCriteria()</span> where the filter creates a constraint on how the data filtered by this filter should look like. We use our generic query criteria <span class="italic">Tx_PtExtlist_Domain_QueryObject_SimpleCriteria</span> with an operator <span class="italic">like</span> here to implement a string filter that uses a LIKE-comparison in its built criteria. <span class="italic">Tx_PtExtlist_Domain_QueryObject_Criteria::like($fieldName, $filterValue)</span> is nothing more but a factory method that returns a criteria object.</p><p>As we mentioned above, a lot of functionality is given to us by our abstract classes, so to get some more information about what the String-Filter does and how it is configured, ake a look at its TypoScript prototype located in Configuration/TypoScript/BaseConfig/Prototype/Filter.txt:</p><pre class="programlisting">
string {
	filterClassName = Tx_PtExtlist_Domain_Model_Filter_StringFilter
	partialPath = Filter/String/StringFilter
	defaultValue =
	accessGroups =

	breadCrumbString = TEXT
	breadCrumbString {
		# Fields that can be used are "label" and "value"
		dataWrap = {field:label} equals {field:value}
	}
}</pre><p>You find a lot more configuration possibilities here than you would assume after looking at the filter class above. First of all, there is a filterClassName, that determines which filter class to instantiate in order to create a string filter object. The partial path leeds us to the HTML template that is used for the filter's user interface. defaultValue lets us set a predefined value when the filter is shown for the first time and accessGroups restricts the filter to certain fe_groups that are allowed to see the filter.</p><p>breadCrumbString enables us to create a TS template for rendering the breadcrumb text of the filter.</p><p>The last thing we have to know, when we want to implement our own filter class is how to actually configure them within our list configuration. Therefore you should take a look at one of the demolists' filterbox configurations. There we find something like this:</p><pre class="programlisting">
filters {
	filterbox1 {
		filterConfigs {
			10 &lt; plugin.tx_ptextlist.prototype.filter.string
			10 {
				filterIdentifier = filter1
				label = LLL:EXT:pt_extlist/Configuration/TypoScript/Demolist/locallang.xml:filter_nameField
				fieldIdentifier = name_local
			}
		}
	}
}</pre><p>All the filters of a list configuration are configured in the <span class="italic">filters</span> section of your configuration. Within this section you have to set up a arbitrary key for the name of your filterbox. In the example above, this is <span class="italic">filterbox1</span>. For each filterbox, you have to set up a list of filters within <span class="italic">filterConfigs</span> and in there we finally have our String-Filter. The basic settings are copied from the prototype above, then we have to change the settings that are unique for our usasge of the filter like filterIdentifier, label and the fieldIdentifier we want to let our filter operate on.</p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05.html"><img src="../images/generic-images/png/prev.png" alt="Prev"></a> </td><td width="20%" align="center"><a accesskey="u" href="ch05.html"><img src="../images/generic-images/png/up.png" alt="Up"></a></td><td width="40%" align="right"> <a accesskey="n" href="ch05s02.html"><img src="../images/generic-images/png/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="../images/generic-images/png/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
